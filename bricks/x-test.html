<template>
  <form class="block">
    <ul>
      <li>Absolutely True</li>
      <li>True</li>
      <li>Sometimes True or False</li>
      <li>False</li>
      <li>Absolutely False</li>
    </ul>

    <p>${ this.question }</p>
    <button on:click="{ this.submit }" value=1>1</button>
    <button on:click="{ this.submit }" value=2>2</button>
    <button on:click="{ this.submit }" value=3>3</button>
    <button on:click="{ this.submit }" value=4>4</button>
    <button on:click="{ this.submit }" value=5>5</button>
  </form>
</template>

<script>
  this.index = 0
  this.time = null
  this.times = []
  this.time = new Date()
  this.answers = []
  this.questions = [
    "what is 42?",
    "Who's D?"
  ]
  this.setState({
    question: ''
  })

  this.connected = async () => {
    const response = await(`/assignment/${this.state.key}/questions`)
    this.questions = response.data
    this.render({ question: this.questions[0] })
  }

  this.submit = async (event) => {
    event.preventDefault()
    this.answers[this.index] = event.target.value
    this.times[this.index] = (new Date()) - this.time
    this.time = new Date()
    if (this.questions.length > this.index + 1) {
      this.index++
      this.render({ question: this.questions[this.index] })
    }
    else {
      const data = { answers: this.answers, times: this.times }
      const response = await api(`/assignment/${this.state.key}/complete`, { data })
      if (response.ok) page('/end')
      else alert("Can't save your data right now. Keep this window and try a little later.")
    }
  }
</script>

<style>
  @import url('/assets/css/main.css')
</style>
