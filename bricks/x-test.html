<template questions key>
  <form class="block">
    <ol>
      <li>Absolutely True</li>
      <li>True</li>
      <li>Sometimes True or False</li>
      <li>False</li>
      <li>Absolutely False</li>
    </ol>

    <p>${ this.question }</p>
    <button on:click="{ this.submit }" value=1>1</button>
    <button on:click="{ this.submit }" value=2>2</button>
    <button on:click="{ this.submit }" value=3>3</button>
    <button on:click="{ this.submit }" value=4>4</button>
    <button on:click="{ this.submit }" value=5>5</button>
  </form>
</template>

<script>
  this.index = 0
  this.time = null
  this.times = []
  this.time = new Date()
  this.answers = []
  this.setState({
    key: "",
    questions: [],
    question: ''
  })

  this.changed = () => {
    this.state.question = this.state.questions[0]
    this.render()
  }

  this.submit = (event) => {
    event.preventDefault()
    const duration = (new Date()) - this.time
    if (duration < 600) return
    this.answers[this.index] = event.target.value
    this.times[this.index] = duration
    this.time = new Date()
    if (this.state.questions.length <= this.index + 1) return this.send()
    this.index++
    this.render({ question: this.state.questions[this.index] })
  }

  this.send = async () => {
    const data = { answers: this.answers, times: this.times }
    const response = await api(`/assignment/${this.state.key}/complete`, { data })
    if (!response.ok) return alert("Can't save your data right now. Keep this window and try a little later.")
    page('/end')
  }
</script>

<style>
  @import url('/assets/css/main.css')
</style>
